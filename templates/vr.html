<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>VR Model Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- A-Frame core -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- Extras: movement controls & joystick for VR -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #info {
        position: absolute;
        top: 10px; left: 10px;
        color: white; font-family: sans-serif;
        background: rgba(0,0,0,0.5); padding: 8px 12px;
        border-radius: 8px;
      }
    </style>
  </head>

  <body>
    <div id="info">Use <b>WASD</b> to move • <b>Mouse</b> to look • <b>VR</b> button to enter</div>

    <a-scene
      vr-mode-ui="enabled: true"
      renderer="colorManagement: true; physicallyCorrectLights: true"
      background="color: #111">

      <!-- Lighting -->
      <a-entity light="type: ambient; color: #888"></a-entity>
      <a-entity light="type: directional; intensity: 1" position="1 3 2"></a-entity>

      <!-- Ground -->
      <a-plane rotation="-90 0 0" width="200" height="200" color="#222"></a-plane>

      <!-- Player rig -->
      <a-entity id="rig" position="0 1.6 5" movement-controls="fly: false; speed: 0.2">
        <a-entity camera look-controls wasd-controls></a-entity>
      </a-entity>

      <!-- Model container -->
      <a-entity id="models"></a-entity>
    </a-scene>

    <script>
      // Fetch GLB list from Flask
      fetch("/models")
        .then(r => r.json())
        .then(files => {
          const container = document.getElementById("models");
          const spacing = 8;
          files.forEach((file, i) => {
            const x = (i % 4) * spacing - (spacing * 2);
            const z = Math.floor(i / 4) * -spacing;

            const el = document.createElement("a-entity");
            el.setAttribute("gltf-model", `url(/static/generated/${file})`);
            el.setAttribute("position", `${x} 0 ${z}`);
            el.setAttribute("scale", "1 1 1");
            el.setAttribute("animation__rotate", "property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear");
            container.appendChild(el);
          });
        });
    </script>
  </body>
</html>
